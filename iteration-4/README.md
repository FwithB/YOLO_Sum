# YOLO与CVAT自动标注系统 - 迭代4

基于MCP架构的YOLO训练与浏览器控制系统，支持自然语言指令控制模型训练和CVAT操作。

## 项目概述

迭代4在迭代3的基础上进行了重大扩展，不仅支持YOLO模型的训练，还添加了浏览器自动化能力，实现了与CVAT（Computer Vision Annotation Tool）的集成。这一升级使系统能够在单一框架内完成从模型训练到数据标注的完整工作流。

## 项目特点

* **MCP客户端-服务器架构**：延续迭代3的分布式设计，进一步扩展功能模块
* **自然语言指令解析**：通过LLM解析用户指令，控制模型训练和浏览器操作
* **YOLO训练支持**：调用Ultralytics YOLOv8进行训练，支持多种模型和参数配置
* **浏览器自动化**：使用Playwright实现浏览器控制，支持CVAT等Web应用的自动操作
* **双重控制模式**：支持自然语言控制和手动参数设置两种操作方式
* **完整的日志系统**：详细记录各个组件的运行状态，方便调试和问题排查

## 系统架构

```
客户端 (main.py) <---> 服务器 (server.py)
                           |
                           +---> 训练模块 (train.py)
                           |
                           +---> 浏览器模块 (browser.py)
```

系统分为四个主要组件：
1. **客户端(main.py)**：处理用户交互、指令解析和请求发送
2. **服务器(server.py)**：接收客户端请求并调用相应模块
3. **训练模块(train.py)**：负责YOLO模型的训练
4. **浏览器模块(browser.py)**：控制浏览器实现CVAT的自动操作

## 主要功能

### YOLO训练功能
* 支持YOLOv8各种型号的模型训练（yolov8n/s/m/l/x）
* 可配置训练轮数、数据集和其他参数
* 实时返回训练状态和结果

### 浏览器自动化功能
* 打开浏览器并导航到CVAT网站
* 自动登录CVAT系统
* 创建新项目并设置标签
* 支持Chrome和Edge等主流浏览器

### 自然语言控制
* 训练指令示例："训练一个yolov8n模型识别猫狗，跑5轮"
* 浏览器指令示例："打开浏览器，访问CVAT并登录"
* 灵活解析复杂指令，提取关键参数

## 与迭代3的主要区别

| 特性 | 迭代3 | 迭代4 |
|------|-------|-------|
| 功能范围 | 仅YOLO训练 | YOLO训练 + 浏览器自动化 |
| 组件数量 | 3个(main.py, server.py, train.py) | 4个(增加browser.py) |
| 自动化程度 | 自动化训练 | 自动化训练和标注工具操作 |
| 工作流集成 | 单一功能 | 完整工作流(训练-标注) |
| 控制能力 | 限于训练参数 | 扩展到Web界面交互 |

## 技术实现详解

### 浏览器自动化实现
* 使用Playwright库实现浏览器控制
* 异步编程模型处理浏览器操作
* 实现了状态检查和错误恢复机制
* 支持元素选择器和键盘交互两种操作方式

### MCP架构扩展
* 新增`/browser`端点处理浏览器控制请求
* 扩展JSON通信协议支持浏览器操作参数
* 改进错误处理和状态报告机制

### 命令解析增强
* 扩展LLM函数调用格式，支持浏览器操作参数
* 添加关键词匹配逻辑，提高解析准确率
* 实现更灵活的默认参数处理

## 环境与依赖

### 服务器端依赖
* Python 3.6+
* ultralytics：YOLOv8模型训练库
* flask：HTTP服务器框架
* playwright：浏览器自动化库

### 客户端依赖
* Python 3.6+
* openai：用于调用OpenRouter API
* requests：用于发送HTTP请求

## 安装步骤

1. 克隆仓库:
```bash
git clone https://github.com/yourusername/YOLO-Browser-MCP.git
cd YOLO-Browser-MCP
```

2. 安装依赖:
```bash
pip install -r requirements.txt
python -m playwright install
```

3. 配置API密钥:
在`main.py`中设置`API_KEY`变量或设置环境变量:
```bash
export OPENROUTER_API_KEY=你的API密钥
```

## 使用方法

### 启动服务器

```bash
python server.py
```

### 运行客户端

```bash
python main.py
```

客户端提供以下操作选项：
1. 使用自然语言指令控制系统
2. 训练YOLO模型（手动参数）
3. 控制浏览器（手动参数）
4. 退出程序

## CVAT操作说明

本系统默认CVAT通过Docker在本地运行，访问地址为`http://localhost:8080`。首次使用前请确保：

1. Docker已启动
2. CVAT容器正在运行：`docker-compose up -d`
3. 默认登录凭据：用户名`admin`，密码由用户设置

## 故障排除

可能遇到的常见问题及解决方案：

1. **浏览器启动失败**：尝试选择其他浏览器类型（如Edge代替Chrome）
2. **CVAT登录问题**：确保使用正确的凭据，检查CVAT服务是否正常运行
3. **请求超时**：检查网络连接和服务器状态
4. **训练过程异常**：查看日志文件获取详细错误信息

## 未来计划

* **数据上传功能**：实现自动上传数据集到CVAT
* **自动标注集成**：将训练好的YOLO模型用于CVAT自动标注
* **标注导出与转换**：支持导出标注数据并转换为YOLO训练格式
* **闭环训练系统**：实现从标注到训练到再标注的完整闭环
* **Web界面**：开发基于浏览器的用户界面，替代命令行客户端

## 贡献与许可证

* **贡献**：欢迎通过Issues和Pull Requests参与项目改进
* **许可证**：本项目采用MIT许可证
